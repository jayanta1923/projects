<!DOCTYPE html>
<html>
<head>
<title>Inventory Management App</title>
<meta charset="UTF-8">
<script src="https://cdn.jsdelivr.net/npm/jsbarcode@3.11.5/dist/JsBarcode.all.min.js"></script>

<style>
body {
    font-family: Arial;
    margin: 0;
    padding: 0;
    background: #f5f5f5;
}
header {
    background: #000;
    color: white;
    padding: 15px;
    font-size: 20px;
    text-align: center;
}

nav {
    display: flex;
    background: #222;
}
nav button {
    flex: 1;
    padding: 12px;
    border: none;
    background: #333;
    color: white;
    font-size: 16px;
    cursor: pointer;
}
nav button.active { background: #000; }

.page { display: none; padding: 20px; }
.page.active { display: block; }

input, button, select {
    padding: 10px;
    margin: 5px;
    font-size: 16px;
}
button {
    cursor: pointer;
    background: black;
    color: white;
    border: none;
    border-radius: 5px;
}

table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 15px;
}
th, td {
    border: 1px solid #ccc;
    padding: 10px;
}

.label-box {
    border: 1px solid #ddd;
    padding: 10px;
    width: 180px;
    text-align: center;
    background: white;
}
</style>
</head>

<body>

<header>Inventory Management System</header>

<nav>
    <button onclick="showPage('add')" class="active">Add Product</button>
    <button onclick="showPage('scan')">Scan Product</button>
    <button onclick="showPage('list')">Inventory List</button>
</nav>

<!-- PAGE 1: ADD PRODUCT -->
<div id="add" class="page active">
    <h2>Add Product</h2>

    <input id="pName" placeholder="Product Name"><br>
    <input id="pPrice" placeholder="Price"><br>
    <input id="pStock" placeholder="Initial Stock"><br>

    <button onclick="addProduct()">Add Product</button>

    <h3>Generated Barcode</h3>
    <div class="label-box">
        <svg id="generatedCode"></svg>
        <p id="generatedNumber"></p>
    </div>
</div>

<!-- PAGE 2: SCAN PRODUCT -->
<div id="scan" class="page">
    <h2>Scan Product</h2>
    <input id="scanInput" placeholder="Scan barcode here">
    <button onclick="findProduct()">Search</button>

    <div id="scanResult"></div>
</div>

<!-- PAGE 3: INVENTORY LIST -->
<div id="list" class="page">
    <h2>Inventory List</h2>

    <input id="searchBox" oninput="renderTable()" placeholder="Search">

    <table id="table">
        <tr>
            <th>Barcode</th>
            <th>Name</th>
            <th>Price</th>
            <th>Stock</th>
            <th>Actions</th>
        </tr>
    </table>
</div>

<script>
// -------------------- NAVIGATION --------------------
function showPage(page) {
    document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
    document.getElementById(page).classList.add('active');

    document.querySelectorAll('nav button').forEach(b => b.classList.remove('active'));
    event.target.classList.add('active');
}

// -------------------- INVENTORY STORAGE --------------------
let inventory = JSON.parse(localStorage.getItem("inventory") || "{}");

function saveInventory() {
    localStorage.setItem("inventory", JSON.stringify(inventory));
}

// -------------------- EAN-13 GENERATION --------------------
function generateEAN13() {
    let num = Math.floor(Math.random() * 1000000000000).toString().padStart(12, "0");
    let check = calcCheck(num);
    return num + check;
}

function calcCheck(n) {
    let sum = 0;
    for (let i = 0; i < 12; i++) {
        sum += parseInt(n[i]) * (i % 2 === 0 ? 1 : 3);
    }
    return (10 - (sum % 10)) % 10;
}

// -------------------- ADD PRODUCT --------------------
function addProduct() {
    let name = pName.value.trim();
    let price = pPrice.value.trim();
    let stock = parseInt(pStock.value.trim() || 0);

    if (!name || !price) {
        alert("Enter full product details");
        return;
    }

    let barcode = generateEAN13();

    inventory[barcode] = { name, price, stock };
    saveInventory();

    JsBarcode("#generatedCode", barcode, { format:"ean13", width:2, height:60 });
    generatedNumber.innerText = barcode;

    pName.value = ""; pPrice.value = ""; pStock.value = "";
    renderTable();
}

// -------------------- SCAN PRODUCT --------------------
function findProduct() {
    let code = scanInput.value.trim();
    let item = inventory[code];

    if (!item) {
        scanResult.innerHTML = "<p style='color:red'>Product Not Found</p>";
        return;
    }

    scanResult.innerHTML = `
        <h3>${item.name}</h3>
        <p>Price: ₹${item.price}</p>
        <p>Stock: ${item.stock}</p>

        <button onclick="updateStock('${code}', 1)">Increase</button>
        <button onclick="updateStock('${code}', -1)">Reduce</button>
    `;
}

function updateStock(code, amount) {
    inventory[code].stock = Math.max(0, inventory[code].stock + amount);
    saveInventory();
    findProduct();
    renderTable();
}

// -------------------- INVENTORY LIST --------------------
function renderTable() {
    let q = searchBox.value.toLowerCase();
    let rows = `
        <tr>
            <th>Barcode</th>
            <th>Name</th>
            <th>Price</th>
            <th>Stock</th>
            <th>Actions</th>
        </tr>
    `;

    for (let code in inventory) {
        let item = inventory[code];
        if (!item.name.toLowerCase().includes(q)) continue;

        rows += `
        <tr>
            <td>${code}</td>
            <td>${item.name}</td>
            <td>₹${item.price}</td>
            <td>${item.stock}</td>
            <td>
                <button onclick="deleteProduct('${code}')">Delete</button>
            </td>
        </tr>
        `;
    }

    table.innerHTML = rows;
}

function deleteProduct(code) {
    if (confirm("Delete this product?")) {
        delete inventory[code];
        saveInventory();
        renderTable();
    }
}

renderTable();
</script>

</body>
</html>
